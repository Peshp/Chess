@model UserBoardsViewModel

<form asp-controller="User" asp-action="Details" method="post" id="moveForm">
    @Html.AntiForgeryToken()
    <input type="hidden" name="boardId" value="@Model.BoardId" />
    <input type="hidden" name="toX" id="toX" />
    <input type="hidden" name="toY" id="toY" />
    <input type="hidden" name="figureId" id="figureId" />

    <div class="container my-5">
        <div class="row g-4">
            <div class="col-md-8 d-flex justify-content-center">
                <div id="chess-board-container" class="shadow-lg rounded p-3 bg-dark border border-secondary" style="border-width: 2px !important;">
                    @await Html.PartialAsync("_GamePartial", Model)
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-lg bg-dark border-secondary h-100">
                    <div class="card-header bg-black text-primary border-secondary d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-uppercase tracking-wider" style="font-size: 0.9rem;">Move History</h5>
                        <span class="badge bg-primary">@Model.MoveHistory.Count() Total</span>
                    </div>
                    
                    <div class="card-body p-0" style="max-height: 600px; overflow-y: auto; background-color: #121212;">
                        <div class="list-group list-group-flush">
                            @for (int i = 0; i < Model.MoveHistory.Count(); i++)
                            {
                                var move = Model.MoveHistory.ElementAt(i);
                                bool isBlackMove = i % 2 != 0;
                                string bgStyle = isBlackMove ? "background-color: #1e2124;" : "background-color: transparent;";

                                <button type="button" 
                                        class="list-group-item list-group-item-action move-history-btn border-secondary text-light d-flex justify-content-between align-items-center py-2"
                                        style="@bgStyle border-bottom: 1px solid rgba(255,255,255,0.05);"
                                        data-tox="@move.PositionX"
                                        data-toy="@move.PositionY"
                                        data-pieceid="@move.FigureImage">

                                    <div class="d-flex align-items-center">
                                        <span class="text-muted me-3 small fw-bold" style="width: 20px;">@(i + 1).</span>

                                        <div class="p-1 rounded me-2"
                                             style="background-color: #1b1e1f; border: 1px solid #343a40; display: flex; align-items: center; justify-content: center;">
                                            <img src="~/images/pieces/@move.FigureImage"
                                                 alt="piece"
                                                 style="width: 24px; height: 24px; object-fit: contain;" />
                                        </div>

                                        <span class="@(isBlackMove ? "text-info" : "text-white")">
                                            Move to <strong class="ms-1">@move.Coordinate</strong>
                                        </span>
                                    </div>
                                    
                                    <i class="bi bi-arrow-counterclockwise text-muted small"></i>
                                </button>
                            }
                        </div>

                        @if (!Model.MoveHistory.Any())
                        {
                            <div class="p-5 text-center text-muted italic">
                                <i class="bi bi-journal-x d-block mb-2" style="font-size: 2rem;"></i>
                                No moves recorded yet.
                            </div>
                        }
                    </div>
                    
                    <div class="card-footer bg-black border-secondary py-3">
                        <div class="d-grid">
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="location.reload()">Reset View</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<style>
    .card-body::-webkit-scrollbar {
        width: 6px;
    }
    .card-body::-webkit-scrollbar-track {
        background: #000;
    }
    .card-body::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 10px;
    }
    .card-body::-webkit-scrollbar-thumb:hover {
        background: #00d2ff;
    }

    .move-history-btn:hover {
        background-color: #25282c !important;
        color: #00d2ff !important;
    }

    .tracking-wider {
        letter-spacing: 0.05rem;
    }
</style>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const historyButtons = document.querySelectorAll('.move-history-btn');
            const form = document.getElementById('moveForm');

            const inputToX = document.getElementById('toX');
            const inputToY = document.getElementById('toY');
            const inputFigureId = document.getElementById('figureId');

            historyButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const x = this.getAttribute('data-tox');
                    const y = this.getAttribute('data-toy');
                    const piece = this.getAttribute('data-pieceid');

                    inputToX.value = x;
                    inputToY.value = y;
                    inputFigureId.value = piece;

                    form.submit();
                });
            });
        });
    </script>
}



